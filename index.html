<!doctype html>
<html lang="en">
<head>
  <meta name="google-site-verification" content="AioHky6gBYFTKoXFnESEp7ri323X5lvvZAtSQ48WSLM" />	
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dragon — Cards</title>
  <style>
    :root{--accent:#0b6;--bg:#0f1720;--card:#0b1220;--glass:rgba(255,255,255,0.04)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;color:#e6eef6;background:#06111a;min-height:100vh;display:flex;flex-direction:column}
    /* background video */
    .bg-video{position:fixed;inset:0;z-index:-1;object-fit:cover;width:100%;height:100%;opacity:0.28}
    header{display:flex;align-items:center;gap:12px;padding:18px 20px}
    header img.logo{width:46px;height:46px;object-fit:contain;border-radius:8px}
    header .title{font-weight:700;font-size:20px}
    .container{padding:18px;max-width:1100px;margin:0 auto;width:100%}
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:12px}
    .btn{background:var(--accent);color:#04211a;padding:10px 12px;border-radius:10px;border:0;font-weight:600;cursor:pointer}
    .btn.ghost{background:transparent;color:#cfe9e0;border:1px solid rgba(255,255,255,0.06)}
    .search{flex:1;min-width:160px}
    input[type=text], input[type=number]{width:100%;padding:10px;border-radius:8px;border:0;background:var(--glass);color:#e6eef6}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,10,0.6);display:flex;flex-direction:column;gap:8px}
    .card .top{display:flex;justify-content:space-between;align-items:center}
    .muted{opacity:0.8;font-size:13px}
    .small{font-size:13px}
    .actions{display:flex;gap:8px;margin-top:6px}
    .note{font-size:13px;color:#9fb7b0}
    footer{margin-top:auto;padding:14px;text-align:center;color:#9fb7b0}
    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,8,0.6);display:none;align-items:center;justify-content:center}
    .modal{background:#07121a;padding:18px;border-radius:12px;max-width:420px;width:96%}
    label{display:block;font-size:13px;margin:8px 0 6px}
    @media(max-width:520px){header .title{font-size:16px} .btn{padding:8px 10px}}
  </style>
</head>
<body>
  <!-- Background video (use background.mp4 in same folder) -->
  <video class="bg-video" autoplay muted loop playsinline>
    <source src="background.mp4" type="video/mp4" />
  </video>

  <header>
    <img src="logo.jpg" alt="logo" class="logo">
    <div class="title">Dragon</div>
  </header>

  <div class="container">
    <div class="controls">
      <button id="addBtn" class="btn">(+) Create card</button>
      <input id="search" class="search" type="text" placeholder="Search cards by name...">
      <button id="exportBtn" class="btn ghost">Export JSON</button>
      <button id="importBtn" class="btn ghost">Import JSON</button>
      <button id="shareBtn" class="btn ghost">Share code</button>
    </div>

    <div class="note">Daily increment: <strong>Rs 10 per day</strong> is added automatically to displayed amounts.</div>

    <div id="cards" class="cards" style="margin-top:12px"></div>
  </div>

  <!-- footer -->
  <footer>Dragon • Your cards are stored locally unless you export or share them.</footer>

  <!-- modal -->
  <div id="modalBackdrop" class="modal-backdrop">
    <div class="modal">
      <h3 id="modalTitle">Create card</h3>
      <label for="name">Name</label>
      <input id="name" type="text" placeholder="e.g. My pocket money">
      <label for="amount">Amount (Rs)</label>
      <input id="amount" type="number" min="0" placeholder="1000">
      <div style="margin-top:10px;display:flex;gap:8px;align-items:center;justify-content:flex-end">
        <button id="cancel" class="btn ghost">Cancel</button>
        <button id="save" class="btn">Save</button>
      </div>
    </div>
  </div>

  <!-- hidden file input for import -->
  <input id="fileInput" type="file" accept="application/json" style="display:none">

<script>
(function(){
  // --- Config ---
  const STORAGE_KEY = 'dragon_cards_v1';
  const DAILY_INCREMENT = 10; // Rs per day
  const AUTO_APPLY_ON_LOAD = true; // if true, on load we update stored baseAmount to include days passed

  // --- util ---
  function $(id){return document.getElementById(id)}
  function uid(){return 'c_'+Math.random().toString(36).slice(2,10)}
  function daysBetween(d1,d2){
    const msPerDay = 1000*60*60*24;
    return Math.floor((d2 - d1) / msPerDay);
  }
  function load(){
    try{const raw=localStorage.getItem(STORAGE_KEY); return raw?JSON.parse(raw):[] }catch(e){return []}
  }
  function save(cards){ localStorage.setItem(STORAGE_KEY, JSON.stringify(cards)) }

  // --- apply daily increments to stored base (so data is synced between devices after import) ---
  function applyDailyIncrements(cards){
    const now = new Date();
    let changed=false;
    cards.forEach(c=>{
      const created = new Date(c.lastApplied || c.createdAt);
      const days = daysBetween(created, now);
      if(days>0){
        c.baseAmount = Number(c.baseAmount) + days * DAILY_INCREMENT;
        c.lastApplied = now.toISOString();
        changed=true;
      }
    });
    if(changed) save(cards);
    return cards;
  }

  // --- calc displayed amount ---
  function displayedAmount(card){
    const last = new Date(card.lastApplied || card.createdAt);
    const now = new Date();
    const days = daysBetween(last, now);
    return Number(card.baseAmount) + days * DAILY_INCREMENT;
  }

  // --- render ---
  const cardsEl = $('cards');
  function render(){
    let cards = load();
    if(AUTO_APPLY_ON_LOAD){ cards = applyDailyIncrements(cards); }
    const q = $('search').value.trim().toLowerCase();
    const filtered = cards.filter(c=>c.name.toLowerCase().includes(q));
    cardsEl.innerHTML = '';
    if(filtered.length===0){ cardsEl.innerHTML = '<div style="grid-column:1/-1;color:#9fb7b0;padding:18px;border-radius:8px;background:rgba(255,255,255,0.02)">No cards found.</div>'; return }
    filtered.sort((a,b)=>a.createdAt < b.createdAt ? 1 : -1);
    filtered.forEach(c=>{
      const el = document.createElement('div'); el.className='card';
      el.innerHTML = `
        <div class="top"><div>
          <div style="font-weight:700">${escapeHtml(c.name)}</div>
          <div class="muted small">Created: ${new Date(c.createdAt).toLocaleString()}</div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:800;font-size:18px">Rs ${numberWithCommas(displayedAmount(c))}</div>
          <div class="muted small">Base: Rs ${numberWithCommas(c.baseAmount)}</div>
        </div></div>
        <div class="muted small">ID: ${c.id}</div>
        <div class="actions">
          <button class="btn ghost" data-action="topup" data-id="${c.id}">Top-up</button>
          
          <button class="btn ghost" data-action="delete" data-id="${c.id}">Delete</button>
        </div>
      `;
      cardsEl.appendChild(el);
    });
  }

  function numberWithCommas(x){return String(x).replace(/\B(?=(\d{3})+(?!\d))/g,",")}
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(ch){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[ch] }); }

  // --- events ---
  $('addBtn').addEventListener('click', ()=>{ $('modalBackdrop').style.display='flex'; $('modalTitle').textContent='Create card'; $('name').value=''; $('amount').value=''; });
  $('cancel').addEventListener('click', ()=>{$('modalBackdrop').style.display='none'});
  $('save').addEventListener('click', ()=>{
    if(prompt('Enter password')!=='yethula') return;
    const name = $('name').value.trim(); const amount = Number($('amount').value) || 0;
    if(!name){ alert('Please enter a name'); return }
    const cards = load();
    const card = { id:uid(), name, baseAmount:amount, createdAt: (new Date()).toISOString(), lastApplied: (new Date()).toISOString() };
    cards.push(card); save(cards); $('modalBackdrop').style.display='none'; render();
  });

  cardsEl.addEventListener('click', (e)=>{
    const btn = e.target.closest('button'); if(!btn) return;
    const act = btn.dataset.action;
    if(prompt('Enter password')!=='yethula') return; const id = btn.dataset.id; let cards = load();
    const idx = cards.findIndex(x=>x.id===id); if(idx===-1) return;
    if(act==='delete'){
      if(!confirm('Delete this card?')) return; cards.splice(idx,1); save(cards); render();
    }else if(act==='topup'){
      const v = prompt('Top-up amount (Rs)','100'); const inc = Number(v); if(!isNaN(inc) && inc>0){ cards[idx].baseAmount = Number(cards[idx].baseAmount) + inc; cards[idx].lastApplied = (new Date()).toISOString(); save(cards); render(); }
    }
  });

  $('search').addEventListener('input', ()=>render());

  // Export JSON
  $('exportBtn').addEventListener('click', ()=>{
    const data = load(); const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='dragon_cards_export.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  });

  // Import JSON
  $('importBtn').addEventListener('click', ()=>$('fileInput').click());
  $('fileInput').addEventListener('change', (e)=>{
    const f = e.target.files[0]; if(!f) return; const reader = new FileReader();
    reader.onload = ()=>{ try{ const parsed = JSON.parse(reader.result); if(!Array.isArray(parsed)){ alert('Invalid file') ; return } localStorage.setItem(STORAGE_KEY, JSON.stringify(parsed)); alert('Imported ' + parsed.length + ' cards.'); render(); }catch(err){alert('Import failed: '+err.message)} };
    reader.readAsText(f);
  });

  // Share code: compressed base64 of data to copy to clipboard
  $('shareBtn').addEventListener('click', async ()=>{
    const data = load(); const json = JSON.stringify(data);
    try{ const encoded = btoa(unescape(encodeURIComponent(json))); await navigator.clipboard.writeText(encoded); alert('Share code copied to clipboard. Paste on another device into Import → Paste code field.'); prompt('Share code (copy and send to other device)', encoded); }catch(e){ // fallback
      const encoded = btoa(unescape(encodeURIComponent(json))); prompt('Share code (copy and send)', encoded);
    }
  });

  // Also provide a paste-import prompt when page opens with a query param like ?paste=1
  // provide a keyboard shortcut: Ctrl+I to paste/import
  window.addEventListener('keydown', (e)=>{ if((e.ctrlKey||e.metaKey) && e.key.toLowerCase()==='i'){ e.preventDefault(); const ip = prompt('Paste share code from other device'); if(!ip) return; try{ const dec = decodeURIComponent(escape(atob(ip))); const parsed = JSON.parse(dec); if(Array.isArray(parsed)){ localStorage.setItem(STORAGE_KEY, JSON.stringify(parsed)); alert('Imported '+parsed.length+' cards'); render(); } else alert('Invalid code'); }catch(err){ alert('Import failed: '+err.message) } } });

  // on load
  render();
})();
</script>
</body>
</html>
